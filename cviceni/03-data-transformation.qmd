---
title: "Cviceni 3: Data Transformation"
editor: visual
---

```{r setup}
require(tidyverse)
```

## Uloha 1

Prozkoumejte dataset `babynames`

```{r}
# install.packages("babynames")
require(babynames)
babynames
```

Upravte kod tak, aby byl na vystupu pouze sloupec `n`.

```{r}
select(babynames, n)
```

## Diamonds

```{r}
data <- filter(diamonds, cut == "Premium")
ggplot(data, aes(carat, price)) +
  geom_point()
```
```{r}
require(gapminder)

filter(gapminder, country == "Finland" | country == "Sweden")
```



## Uloha 2

Pouzijte funkci `filter`, dataset `babynames` a vhodny logicky operator a najdete:

-   Vsechna jmena, kde hodnota `prop` je vetsi nebo rovna 0.08
-   Vsechny deti se jmenem "Sea"

```{r}
filter(babynames, prop >= 0.08)
```

```{r}
filter(babynames, name == "Sea")
```
```{r}
filter(babynames, prop >= 0.08, name == "Sea")
```


## Uloha 3

Pomoci logickych operatoru najdete radky, ktere obsahuji:

- *Chlapce* se jmenem Sue
- Jmena, ktera v roce 1880 pouzilo presne 5 nebo 6 deti
- Jmena, ktera jsou jednim z nasledujicich jmen: Acura, Lexus nebo Yugo

```{r}
filter(babynames, sex == "M", name == "Sue")
```

```{r}
filter(babynames, year == 1880, n %in% c(5, 6))
filter(babynames, year == 1880, n == 5 | n ==6)
filter(babynames, year == 1880, n >= 5, n <= 6)
```

```{r}
filter(babynames, name %in% c("Acura", "Lexus", "Yugo"))
```


## Uloha 4

Nad datasetem `babynames`:

- Jaka je nejmensi hodnota `n`?
- Jaka je nejvetsi hodnota znaku `prop`?

```{r}
arrange(babynames, n)
```

```{r}
arrange(babynames, desc(prop))
```



## Uloha 5

Pomoci `|>` napiste posloupnost funkci, ktere:

1.  vyfiltruje `babynames` pouze na divky narozene v roce 2017, *potom...*
2.  vybere sloupce `name` a `n`, *potom...*
3.  usporadejte vysledky tak, aby nejoblibenejsi jmena byla navrchu tabulky.

```{r}
girls_2017 <- babynames |> 
  filter(sex == "F", year == 2017) |>
  select(name, n) |>  # just to make it smaller
  arrange(-n)
```

```{r}
babynames |>
  filter(sex == "F", year == 2017) %T>%
  # View("after filter") |>
  select(name, n) |>  # just to make it smaller
  # arrange(-n) |>
  identity()
```


```{r}
babynames |> 
  filter(sex == "F", year == 2017) |> 
  select(name, n) |> 
  arrange(-n) -> 
  data_2017
```

```{r}
arrange(select(filter(babynames, sex == "F", year == 2017), name, n), -n)

```


## Uloha 6

1.  Oriznete `babynames` pouze na radky, ktere obsahuji vase jmeno a pohlavi.
2.  Oriznete vysledek pouze na sloupce, ktere se zobrazi v grafu (neni nezbytne nutne, ale je to uzitecny postup).
3.  Vysledky vykreslete jako spojnicovy graf s rokem na ose x a relativni cetnosti na ose y.

```{r}
babynames |> 
  filter(sex == "M", name == "Jan") |> 
  # select(-sex, -name) |> 
  select(year, prop) |> 
  ggplot(aes(year, prop)) + 
  geom_line() +
  scale_y_continuous(labels=scales::percent)
```


## Uloha 7

Doplnte nize uvedeny kod, abyste vybrali radky, kde `name == "Khaleesi"`. Pote pouzijte `summarise()` a `sum()` a `min()` ke zjisteni:

1.  Celkovy pocet deti se jmenem Khaleesi
2.  Prvni rok, kdy se Khaleesi objevila v datech

```{r}
babynames |> 
  filter(name == "Khaleesi") |> 
  summarise(total = sum(n), first = min(year))
```


## Uloha 8

Pouzijte funkce `group_by()`, `summarise()` a `arrange()` pro zobrazeni deseti nejpopularnejsich jmen. Popularitu spocitejte jako celkovy pocet deti narozenych s danym pohlavim a jmenem.

```{r}
babynames |> 
  _______(name, sex) |> 
  _______(total = _____(n)) |> 
  _______(desc(_____))
```


## Uloha 9

Pouzijte funkci `group_by()` pro spocitani a vykresleni celkoveho poctu narozenych deti v jednotlivych letech.

```{r}
babynames |>
  group_by(year, sex) |>
  summarise(total = sum(n), .groups = "drop") |>
  ggplot(aes(year, total / 1000000, fill = sex, color = sex)) +
  geom_area(alpha = 0.4) +
  geom_vline(xintercept = 1958, alpha = 0.5) +
  labs(y = "Number of children [million]") +
  theme_minimal()

```


```{r}
babynames |> 
  group_by(sex, name) |> 
  mutate(cumcount = cumsum(n)) |> 
  filter(name == "Mary")

```

```{r}
babynames |> 
  group_by(year, sex) |> 
  mutate(n_year = sum(n)) |> 
  ungroup() |> 
  mutate(perc = round(100 * n / n_year, 2))
```


## Uloha 10

Pouzijte `mutate()` a `min_rank()` pro ocislovani jednotlivych radku v tabulce podle poctu `n` od nejvetsiho.

```{r}
babynames |> 
  ______(rank = _______(____(n)))
```


## Uloha 11

Seskupte datav tabulce `babynames` podle roku a potom ocislujte data podle poctu. Vyfiltruje pouze vysledky, kde `rank == 1` (nejvyssi hodnota dany rok).

```{r}
```


## Uloha 12

Najdete a opravte chyby v nasledujicich kodech. Ctete pozorne chybovou hlasku v konzoli.

### Uloha 12.a

```{r}
babynames |> 
  filter(name = "Mike")
```

### Uloha 12.b

```{r}
babynames |> 
  filter(name == "Michael") |> 
  ggplot(aes(year, prop, color = sex)) |>
  geom_line()
```

### Uloha 12.c

Nasledujici kod nespadne na zadne chybe, ale vraci `NA` hodnoty. Dokazete odhadnout proc?

Napoveda: Nahradte funkce `mean` a `var` funkci `length`.

```{r}
babynames |> 
  summarise(n = mean(n), n_var = var(n))
```

